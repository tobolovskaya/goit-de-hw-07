#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ Apache Airflow

echo "üöÄ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Apache Airflow –¥–ª—è Olympic Medal Processing DAG"

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ–π
echo "üìÅ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ–π..."
mkdir -p logs plugins

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É
echo "üîê –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É..."
chmod +x setup.sh

# –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è —Ñ–∞–π–ª—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
if [ ! -f .env ]; then
    echo "üìã –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–∞–π–ª—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó..."
    cp .env.example .env
    echo "‚ö†Ô∏è  –ë—É–¥—å –ª–∞—Å–∫–∞, –≤—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ —Ñ–∞–π–ª .env –∑–∞ –ø–æ—Ç—Ä–µ–±–∏"
fi

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö Airflow
echo "üóÑÔ∏è  –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö..."
docker-compose up airflow-init

echo "‚úÖ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo ""
echo "üéØ –î–ª—è –∑–∞–ø—É—Å–∫—É Airflow –≤–∏–∫–æ–Ω–∞–π—Ç–µ:"
echo "   docker-compose up -d"
echo ""
echo "üåê –í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –∑–∞ –∞–¥—Ä–µ—Å–æ—é:"
echo "   http://localhost:8080"
echo "   –õ–æ–≥—ñ–Ω: admin"
echo "   –ü–∞—Ä–æ–ª—å: admin"
echo ""
echo "üìä MySQL –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –Ω–∞ –ø–æ—Ä—Ç—É 3306"
echo "   –•–æ—Å—Ç: localhost"
echo "   –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: airflow"
echo "   –ü–∞—Ä–æ–ª—å: airflow"